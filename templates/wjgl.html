<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Video Monitor</title>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="../static/plugins/fontawesome-free/css/all.min.css">
    <!-- IonIcons -->
    <link rel="stylesheet" href="../static/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../static/css/adminlte.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.4.2/css/buttons.dataTables.min.css"/>
    <!-- Google Font: Source Sans Pro -->
    <link href="../static/css/googleapis.css" rel="stylesheet">
    <script src=" ../static/plugins/jquery/jquery.min.js "></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.2/js/dataTables.buttons.min.js"></script>
    <style>
         ::-webkit-scrollbar {
            display: none;
        }
        
        html,
        body {
            overflow: scroll;
            height: 100%;
            margin: 0;
        }
    </style>
</head>

<body class="sidebar-mini control-sidebar-open sidebar-collapse">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
    <div class="alert alert-{{category}}">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      {{ message }}
    </div>
            {% endfor %}
        {% endif %}        
    {% endwith %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <!-- /.card-header -->
                <div class="card-body">
                  <div id="example1_wrapper" class="dataTables_wrapper dt-bootstrap4">
                      <div class="row">
                          <div class="col-sm-12">
                              <table id="example2" class="table table-bordered table-striped dataTable" role="grid">
                    <thead>
                    <tr role="row">
                        <th class="sorting" style="width: 150px;">文件名称</th>
                        <th class="sorting" style="width: 120px;">文件大小</th>
                        <th class="sorting" style="width: 166px;">上传时间</th>
                        <th class="sorting" style="width: 146px;">播放链接</th>
                        <th class="sorting" style="width: 75px;">操作</th>
                    </tr>
                    </thead>
                  </table>
                </div>
                <!-- /.card-body -->
              </div>
    <!-- /.card -->
    <!-- modal -->
    <div class="row" id="bar" style="width:100%; height:100%;"></div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">视频文件上传</h4>
                </div>
                <div class="modal-body">
                    <form role="form" action="/wjgl" method="POST" enctype="multipart/form-data">
                        {{ form.csrf_token }}
                        <div class="box-body">
                             {{ form.video_file(multiple="multiple",accept=".mp4,.flv,.jpeg")}}
                            <p class="help-block"><font style="vertical-align: middle;"><font style="vertical-align: middle;">仅支持MP4和FLV文件上传</font></font></p>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                                </button>
                                {{ form.submit(class="btn btn-primary")}}
                                <!-- <button type="submit" class="btn btn-primary"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交</font></font></button> -->
                            </div>
                          </div>
                        <!-- /.box-body -->
                      </form>
                </div>
                
            </div><!-- /.modal-content -->
        </div>
        <!-- /.modal -->
    </div>
    <!-- <div class="modal fade" id="play" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">在线预览</h4>
                </div>
                <div class="modal-body">
                        <div class="box-body">
                            <div><video controls="" autoplay="" name="media"><source src="https://icbvod.yzbabyu.com:8443/icb/Smalling.mp4" type="video/mp4"></video></div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                                </button>
                                </div>
                          </div>
                </div>
                
            </div>
        </div>
    </div> -->

    <div class="modal fade"
    id="play"
    tabindex="-1"
    role="dialog"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="embed-responsive embed-responsive-16by9 modal-content">
            <iframe scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>
        </div>
    </div>
    </div>
    <script>
        $(document).ready(function() {
        var $table=$('#example2').DataTable( {
        "paging": true,
        "searching": true,
        "ordering": true,
        "info": true,
        "autoWidth": false,
        "lengthMenu":[15,50,100],
        "ajax": "/wjcz",
        "dom": 'Bfrtip',
        "buttons": [
            {
                extend: 'reload',
                text: '<i class="fa fa-undo" aria-hidden="true"></i>'
            },
            {
                extend: 'upload',
                text: '<i class="fa fa-file-video" aria-hidden="true"></i>'
            },
        ],
        "columnDefs" : [ {
            // 定义操作列,######以下是重点########
            "targets" : 4,//操作按钮目标列
            "data" : null,
            //"defaultContent":"<a id='playv' href= '#' onclick='playv(data)'' ><i class='fa fa-play' data-toggle='modal' data-target='#play'  >播放</i></a>",
            "render" : function(data,type,row) {
            //console.log(data)
            var html = "<a id='playv' ><i class='fa fa-play' data-toggle='modal' data-target='#play' >播放</i></a>"
            html += "<a id='editv'  class='btn btn-default btn-xs'><i class='fa fa-cog'></i> 编辑</a>"
            html += "<a id='delv'  class='btn btn-default btn-xs'><i class='fa fa-times'></i> 删除</a>"
            return html;
}
} ],
        "columns": [
             { "data": "wjname" },
             { "data": "wjsize" },
             { "data": "wjtime" },
             { "data": "wjplay" }
         ]
     } );
    
        } );
    
    </script>
    <script>
        $.fn.dataTable.ext.buttons.reload = {
            action: function ( e, dt ) {
                console.log(e,dt)
                dt.ajax.reload();
            }
        };
        $.fn.dataTable.ext.buttons.upload = {
            action: function () {
                $("#myModal").modal();
            }
        };
    </script>
    <script>
    function playv() {
        //console.log(data)
        console.log(1)
    };
    </script>
    <script>
    $("#play").on("hidden.bs.modal",function(){
    $(this).find("iframe").removeAttr("src");
    });
    // $("#play").on("show.bs.modal",function(){
    //     var name = $("#play").data("wjplay"); 
    //     console.log(name)
    //     //$(this).find("#play iframe").Attr("src",data);
    // });
    function edit() {
        var request=new XMLHttpRequest();//建立request请求
        
        request.open('post','/edit');//发送对象是boke.php 发送post
        
        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');//请求头 默认即可
        
        var name=form1.name.value;//获取文本框内输入的内容
        
        request.send("name="+name);//发送request请求 请求可以有多个post 格式：key1=value1&key2=value2 php端根据key取出value
        //确认接收消息
        request.onreadystatechange=function () {
            // readyState=4为php收到并返回值 status为返回字段为200火304
            if(request.readyState==4&&(request.status==200||request.status==304)){
                //弹出窗口显示php返回的值
                alert(request.responseText);
            }
        }

    };
    function del() {
        var request=new XMLHttpRequest();//建立request请求
        
        request.open('post','/del');//发送对象是boke.php 发送post
        
        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');//请求头 默认即可
        
        var name=form1.name.value;//获取文本框内输入的内容
        
        request.send("name="+name);//发送request请求 请求可以有多个post 格式：key1=value1&key2=value2 php端根据key取出value
        //确认接收消息
        request.onreadystatechange=function () {
            // readyState=4为php收到并返回值 status为返回字段为200火304
            if(request.readyState==4&&(request.status==200||request.status==304)){
                //弹出窗口显示php返回的值
                alert(request.responseText);
            }
        }

    }
    </script>
    <!-- Bootstrap -->
    <script src="../static/plugins/bootstrap/js/bootstrap.bundle.min.js "></script>
    <!-- AdminLTE -->
    <script src="../static/js/adminlte.js "></script>
    <script>
        /*Fixing iframe window.innerHeight 0 issue in Safari*/
        document.body.clientHeight;
    </script>
    <!-- OPTIONAL SCRIPTS -->
</body>

</html>